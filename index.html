<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    
<!-- Font Awesome -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
<!-- Bootstrap core CSS -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.0.0/css/bootstrap.min.css" rel="stylesheet">
<!-- Material Design Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.5.0/css/mdb.min.css" rel="stylesheet">

<!-- JQuery -->
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<!-- Bootstrap tooltips -->
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.13.0/umd/popper.min.js"></script>
<!-- Bootstrap core JavaScript -->
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.0.0/js/bootstrap.min.js"></script>
<!-- MDB core JavaScript -->
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.5.0/js/mdb.min.js"></script>


    <title>Document</title>
</head>
<body>
   

    <canvas id="barChart"></canvas>
                        
    <code>
        $ db.incidents.aggregate([{"$unwind":"$fields"},{ $group : { _id : {$substr:["$fields.date", 0, 4]}, count : { $sum : 1 } } }, {$sort : {count : -1}}]);
    </code>


<script>

//bar
var ctxB = document.getElementById("barChart").getContext('2d');
var myBarChart = new Chart(ctxB, {
    type: 'bar',
    data: {
        labels: ["2014", "2015", "2016", "2017", "2018"],
        datasets: [{
            label: 'Accidents (tt donnees)',
            data: [439, 520, 660, 752, 49],
            backgroundColor: [
                'rgba(255, 99, 132, 0.2)',
                'rgba(54, 162, 235, 0.2)',
                'rgba(255, 206, 86, 0.2)',
                'rgba(75, 192, 192, 0.2)',
                'rgba(153, 102, 255, 0.2)'
            ],
            borderColor: [
                'rgba(255,99,132,1)',
                'rgba(54, 162, 235, 1)',
                'rgba(255, 206, 86, 1)',
                'rgba(75, 192, 192, 1)',
                'rgba(153, 102, 255, 1)'
            ],
            borderWidth: 1
        }]
        
    },
    options: {
        scales: {
            yAxes: [{
                ticks: {
                    beginAtZero:true
                }
            }]
        }
    }
});
            
    </script>


<canvas id="lineChart"></canvas>
          
<code>
        $ db.getCollection('incidents').find({ "fields.type" :{ $regex : "^Déraillement" },"fields.date" : { $regex : "^2016" }}).count();
    </code>
<code>
    $ db.getCollection('incidents').find({ "fields.type" :{ $regex : "^Déraillement" },"fields.date" : { $regex : "^2016" }, "fields.esr" : "oui"}).count();
</code>


<script>
//line
var ctxL = document.getElementById("lineChart").getContext('2d');
var myLineChart = new Chart(ctxL, {
    type: 'line',
    data: {
        labels: ["2014", "2015", "2016", "2017", "2018"],
        datasets: [
            {
                label: 'Deraillements',
                fillColor: "rgba(220,220,220,0.2)",
                strokeColor: "rgba(220,220,220,1)",
                pointColor: "rgba(220,220,220,1)",
                pointStrokeColor: "#fff",
                pointHighlightFill: "#fff",
                pointHighlightStroke: "rgba(220,220,220,1)",
                data: [87, 104, 54, 35, 3]
            },
            {
                label: 'Dont Deraillements ERS',
                fillColor: "rgba(151,187,205,0.2)",
                strokeColor: "rgba(151,187,205,1)",
                pointColor: "rgba(151,187,205,1)",
                pointStrokeColor: "#fff",
                pointHighlightFill: "#fff",
                pointHighlightStroke: "rgba(151,187,205,1)",
                data: [5, 19, 15, 12, 3]
            }
        ]
    },
    options: {
        responsive: true
    }    
});
            
</script>    

<canvas id="lineChart2"></canvas>
                
<script>
//line
var ctxL = document.getElementById("lineChart2").getContext('2d');
var myLineChart = new Chart(ctxL, {
    type: 'line',
    data: {
        labels: ["2014", "2015", "2016", "2017", "2018"],
        datasets: [
            {
                label: 'Collisions',
                fillColor: "rgba(255, 99, 132, 0.2)",
                strokeColor: "rgba(255, 99, 132, 0.2)",
                pointColor: "rgba(255, 99, 132, 0.2)",
                pointStrokeColor: "#fff",
                pointHighlightFill: "#fff",
                pointHighlightStroke: "rgba(255, 99, 132, 0.2)",
                data: [50, 63, 75, 41, 3]
            },
            {
                label: 'Dont Collisions ERS',
                fillColor: "rgba(255, 99, 132, 0.2)",
                strokeColor: "rgba(255, 99, 132, 0.2)",
                pointColor: "rgba(255, 99, 132, 0.2)",
                pointStrokeColor: "#222",
                pointHighlightFill: "#222",
                pointHighlightStroke: "rgba(255, 99, 132, 0.2)",
                data: [4, 19, 17, 16, 2]
            }
        ]
    },
    options: {
        responsive: true
    }    
});
            
</script>    


<canvas id="barChart4"></canvas>
                        
<code>
    $ db.getCollection('incidents').find({ "fields.type" : "Erreur de procédure" ,"fields.date" : { $regex : "^2014" }}).count();
</code>


<script>

//bar
var ctxB = document.getElementById("barChart4").getContext('2d');
var myBarChart = new Chart(ctxB, {
type: 'bar',
data: {
    labels: ["2014", "2015", "2016", "2017", "2018"],
    datasets: [{
        label: 'Erreur de procédure',
        data: [3, 2, 44, 54, 8],
        backgroundColor: [
            'rgba(255, 99, 132, 0.2)',
            'rgba(54, 162, 235, 0.2)',
            'rgba(255, 206, 86, 0.2)',
            'rgba(75, 192, 192, 0.2)',
            'rgba(153, 102, 255, 0.2)'
        ],
        borderColor: [
            'rgba(255,99,132,1)',
            'rgba(54, 162, 235, 1)',
            'rgba(255, 206, 86, 1)',
            'rgba(75, 192, 192, 1)',
            'rgba(153, 102, 255, 1)'
        ],
        borderWidth: 1
    }]
    
},
options: {
    scales: {
        yAxes: [{
            ticks: {
                beginAtZero:true
            }
        }]
    }
}
});
        
</script>
        
    <div class="esr">
        Un ESR est un incident de sécurité lié à la circulation effective d'un train qui met, 
        ou risque de mettre, 
        en danger la vie des personnes transportées et aux abords des installations ferroviaires
    </div>

</body>


            
</html>